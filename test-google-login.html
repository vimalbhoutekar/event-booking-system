<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Google OAuth</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }

      .container {
        background: white;
        padding: 40px;
        border-radius: 15px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 500px;
        width: 100%;
        text-align: center;
      }

      h1 {
        color: #333;
        margin-bottom: 10px;
        font-size: 28px;
      }

      .subtitle {
        color: #666;
        margin-bottom: 30px;
        font-size: 14px;
      }

      .google-btn {
        background: #4285f4;
        color: white;
        border: none;
        padding: 15px 30px;
        font-size: 16px;
        border-radius: 5px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        transition: background 0.3s;
        text-decoration: none;
        margin-bottom: 20px;
      }

      .google-btn:hover {
        background: #357ae8;
      }

      .google-icon {
        background: white;
        padding: 5px;
        border-radius: 3px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .status {
        margin-top: 30px;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 8px;
        text-align: left;
      }

      .status h3 {
        color: #333;
        margin-bottom: 15px;
        font-size: 18px;
      }

      .status-item {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px solid #e9ecef;
      }

      .status-item:last-child {
        border-bottom: none;
      }

      .status-label {
        color: #666;
        font-weight: 500;
      }

      .status-value {
        color: #333;
        font-weight: 600;
      }

      .status-value.success {
        color: #10b981;
      }

      .status-value.error {
        color: #ef4444;
      }

      .user-info {
        background: #f0f9ff;
        border-left: 4px solid #4285f4;
        padding: 15px;
        margin-top: 20px;
        border-radius: 5px;
        text-align: left;
      }

      .user-info p {
        margin: 5px 0;
        color: #333;
      }

      .user-info strong {
        color: #4285f4;
      }

      .test-api-btn {
        background: #10b981;
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 5px;
        cursor: pointer;
        margin-top: 15px;
        font-size: 14px;
        transition: background 0.3s;
      }

      .test-api-btn:hover {
        background: #059669;
      }

      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #4285f4;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üîê Google OAuth Test</h1>
      <p class="subtitle">Event Booking System - Authentication Test</p>

      <a href="http://localhost:9001/auth/google" class="google-btn">
        <span class="google-icon">
          <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M9 3.48c1.69 0 2.83.73 3.48 1.34l2.54-2.48C13.46.89 11.43 0 9 0 5.48 0 2.44 2.02.96 4.96l2.91 2.26C4.6 5.05 6.62 3.48 9 3.48z"
              fill="#EA4335"
            />
            <path
              d="M17.64 9.2c0-.74-.06-1.28-.19-1.84H9v3.34h4.96c-.1.83-.64 2.08-1.84 2.92l2.84 2.2c1.7-1.57 2.68-3.88 2.68-6.62z"
              fill="#4285F4"
            />
            <path
              d="M3.88 10.78A5.54 5.54 0 0 1 3.58 9c0-.62.11-1.22.29-1.78L.96 4.96A9.008 9.008 0 0 0 0 9c0 1.45.35 2.82.96 4.04l2.92-2.26z"
              fill="#FBBC05"
            />
            <path
              d="M9 18c2.43 0 4.47-.8 5.96-2.18l-2.84-2.2c-.76.53-1.78.9-3.12.9-2.38 0-4.4-1.57-5.12-3.74L.97 13.04C2.45 15.98 5.48 18 9 18z"
              fill="#34A853"
            />
          </svg>
        </span>
        Sign in with Google
      </a>

      <div class="status">
        <h3>Connection Status</h3>
        <div class="status-item">
          <span class="status-label">Backend Server:</span>
          <span class="status-value" id="serverStatus">Checking...</span>
        </div>
        <div class="status-item">
          <span class="status-label">Authentication:</span>
          <span class="status-value" id="authStatus">Not logged in</span>
        </div>
        <div class="status-item">
          <span class="status-label">Cookie:</span>
          <span class="status-value" id="cookieStatus">Not found</span>
        </div>
      </div>

      <div id="userInfo" class="user-info hidden"></div>

      <button
        id="testApiBtn"
        class="test-api-btn hidden"
        onclick="testGetProfile()"
      >
        üß™ Test /users/me API
      </button>
    </div>

    <script>
      // Check backend server status
      async function checkServer() {
        try {
          const response = await fetch('http://localhost:9001/api-spec', {
            method: 'GET',
          });

          if (response.ok) {
            document.getElementById('serverStatus').textContent =
              'Connected ‚úÖ';
            document.getElementById('serverStatus').classList.add('success');
          } else {
            document.getElementById('serverStatus').textContent = 'Error ‚ùå';
            document.getElementById('serverStatus').classList.add('error');
          }
        } catch (error) {
          document.getElementById('serverStatus').textContent = 'Offline ‚ùå';
          document.getElementById('serverStatus').classList.add('error');
        }
      }

      // Check if user is logged in
      async function checkAuth() {
        try {
          const response = await fetch('http://localhost:9001/users/me', {
            credentials: 'include', // Important: send cookies
          });

          if (response.ok) {
            const user = await response.json();

            // Update status
            document.getElementById('authStatus').textContent = 'Logged in ‚úÖ';
            document.getElementById('authStatus').classList.add('success');
            document.getElementById('cookieStatus').textContent = 'Found ‚úÖ';
            document.getElementById('cookieStatus').classList.add('success');

            // Show user info
            const userInfoDiv = document.getElementById('userInfo');
            userInfoDiv.innerHTML = `
                        <p><strong>Name:</strong> ${user.firstname} ${user.lastname}</p>
                        <p><strong>Email:</strong> ${user.email}</p>
                        <p><strong>Role:</strong> ${user.role}</p>
                        <p><strong>User ID:</strong> ${user.id}</p>
                    `;
            userInfoDiv.classList.remove('hidden');

            // Show test button
            document.getElementById('testApiBtn').classList.remove('hidden');
          } else {
            document.getElementById('authStatus').textContent =
              'Not logged in ‚ö†Ô∏è';
            document.getElementById('cookieStatus').textContent =
              'Not found ‚ö†Ô∏è';
          }
        } catch (error) {
          console.error('Auth check error:', error);
          document.getElementById('authStatus').textContent = 'Error ‚ùå';
          document.getElementById('authStatus').classList.add('error');
        }
      }

      // Test API call
      async function testGetProfile() {
        const btn = document.getElementById('testApiBtn');
        btn.innerHTML = '<span class="loading"></span> Testing...';
        btn.disabled = true;

        try {
          const response = await fetch('http://localhost:9001/users/me', {
            credentials: 'include',
          });

          if (response.ok) {
            const user = await response.json();
            alert(
              `‚úÖ API Test Successful!\n\nUser: ${user.firstname} ${user.lastname}\nEmail: ${user.email}`,
            );
          } else {
            alert('‚ùå API Test Failed!\n\nStatus: ' + response.status);
          }
        } catch (error) {
          alert('‚ùå API Test Error!\n\n' + error.message);
        } finally {
          btn.innerHTML = 'üß™ Test /users/me API';
          btn.disabled = false;
        }
      }

      // Run checks on page load
      window.addEventListener('load', () => {
        checkServer();
        checkAuth();
      });

      // Auto-refresh status every 3 seconds
      setInterval(() => {
        checkAuth();
      }, 3000);
    </script>
  </body>
</html>
